<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- PDC Form Wizard -->
    <record id="sh_pdc_payment_form_view" model="ir.ui.view">
        <field name="name">sh.pdc.wizard</field>
        <field name="model">pdc.wizard</field>
        <field name="arch" type="xml">
            <form string="PDC Payment">
                <header>
                    <button name="action_register"
                            string="Register"
                            type="object"
                            class="oe_highlight"
                            invisible="state not in ('draft', 'returned')"
                            data-hotkey="v"/>

                    <button name="action_deposited"
                            string="Deposit"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'registered'"
                            data-hotkey="d"/>

                    <button name="action_returned"
                            string="Return"
                            type="object"
                            class="oe_highlight"
                            invisible="state not in ('registered', 'bounced')"
                            data-hotkey="r"/>

                    <button name="action_bounced"
                            string="Bounce"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'deposited'"
                            data-hotkey="b"/>

                    <button name="action_done"
                            string="Done"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'deposited'"
                            data-hotkey="g"/>

                    <button name="action_cancel"
                            string="Cancel"
                            type="object"
                            invisible="state != 'returned'"
                            data-hotkey="z"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,registered,deposited,done"/>
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box">
                        <button name="open_attachments" class="oe_stat_button" icon="fa-cloud-upload" type="object"
                                string="Attachments"/>
                        <button name="open_journal_items" class="oe_stat_button" icon="fa-list" type="object"
                                string="Journal Items"/>
                        <button name="button_open_tax_entry" type="object" class="oe_stat_button"
                                invisible="tax_move_id == False">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Tax Entry</span>
                            </div>
                        </button>
                        <button name="open_journal_entry" class="oe_stat_button" icon="fa-list" type="object"
                                string="Journal Entry"/>
                    </div>

                    <group>
                        <group>
                            <field name="tax_move_id" readonly="1"/>
                            <field name="name" readonly="1"/>
                            <field name="payment_type" readonly="state not in ['draft','bounced']" widget="radio"/>
                            <field name="register_partner_account" readonly="state not in ['draft','bounced']"
                                   widget="radio"/>
                            <field name="currency_id"/>
                            <field name="partner_id"
                                   invisible="register_partner_account == 'account'"
                                   required="register_partner_account == 'partner'"
                                   readonly="state not in ['draft','bounced']"/>
                            <field name="account_id"
                                   invisible="register_partner_account == 'partner'"
                                   required="register_partner_account == 'account'"
                                   readonly="state not in ['draft','bounced']"/>
                            <field name="company_id" invisible="1"/>
                            <field name="payment_amount" widget="monetary"
                                   readonly="state not in ['draft','bounced']"/>
                            <field name="reference" readonly="state not in ['draft','bounced']"/>
                            <field name="journal_id" options="{'no_create':1,'no_create_edit':1}"
                                   readonly="state not in ['draft','bounced']"/>
                            <field name="account_id_under_collection" options="{'no_create':1,'no_create_edit':1}"
                                   readonly="state not in ['draft','registered','bounced']"/>
                        </group>
                        <group>
                            <field name="payment_date" readonly="state not in ['draft','bounced']"/>
                            <field name="due_date" readonly="state not in ['draft','bounced']"
                                   required="line_ids == False"/>
                            <field name="memo" readonly="state not in ['draft','bounced']"/>
                            <field name="agent" readonly="state not in ['draft','bounced']"/>
                            <field name="bank_id" readonly="state not in ['draft','bounced']"/>
                            <field name="tax_id" readonly="state not in ['draft','bounced']"/>
                            <field name="account_payment_id" readonly="1"/>
                            <field name="parent_id" readonly="1"/>
                            <field name="pdc_group" invisible="pdc_group == False"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Attachments">
                            <field name="attachment_ids" widget="many2many_binary"/>
                        </page>
                        <page string="SubCheques" invisible="pdc_group == False">
                            <field name="line_ids"
                                   readonly="state != 'draft'"
                                   required="pdc_group == True"
                                   context="{'default_register_partner_account': register_partner_account,'default_partner_id': partner_id,'default_account_id': account_id,'default_parent_id':id,'default_journal_id': journal_id,'default_account_id_under_collection': account_id_under_collection,  'default_currency_id':currency_id, 'default_payment_type' : payment_type}">
                                <list editable="bottom">
                                    <field name="parent_id" invisible="1"/>
                                    <field name="name" readonly="1"/>
                                    <field name="payment_type"/>
                                    <field name="register_partner_account"/>
                                    <field name="partner_id" invisible="parent.register_partner_account == 'account'"/>
                                    <field name="account_id" invisible="parent.register_partner_account == 'partner'"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="reference"/>
                                    <field name="payment_amount"/>
                                    <field name="journal_id"/>
                                    <field name="account_id_under_collection"/>
                                    <field name="payment_date"/>
                                    <field name="due_date" required="1"/>
                                    <field name="memo"/>
                                    <field name="currency_id"/>
                                    <field name="agent"/>
                                    <field name="bank_id"/>
                                    <field name="state" readonly="1"/>
                                    <button string="Details" type="object" name="action_open" class="oe_highlight"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- PDC Tree view -->
    <record id="sh_pdc_tree_form" model="ir.ui.view">
        <field name="name">sh.pdc.tree.view</field>
        <field name="model">pdc.wizard</field>
        <field name="arch" type="xml">
            <list>
                <field name="currency_id"/>
                <field name="parent_id" invisible="parent_id == False"/>
                <field name="payment_date"/>
                <field name="name"/>
                <field name="reference"/>
                <field name="journal_id"/>
                <field name="partner_id"/>
                <field name="account_id"/>
                <field name="due_date"/>
                <field name="payment_amount" sum="Total"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <!-- PDC Filter -->
    <record id="view_sh_pdc_filter" model="ir.ui.view">
        <field name="name">pdc.payment.select</field>
        <field name="model">pdc.wizard</field>
        <field name="arch" type="xml">
            <search string="Search PDC Payment">
                <filter name="draft" string="Draft" domain="[('state','=','draft')]"/>
                <filter name="registered" string="Registered" domain="[('state','=','registered')]"/>
                <filter name="returned" string="Returned" domain="[('state','=','returned')]"/>
                <filter name="deposited" string="Deposited" domain="[('state','=','deposited')]"/>
                <filter name="bounced" string="Bounced" domain="[('state','=','bounced')]"/>
                <filter name="cancel" string="Cancelled" domain="[('state','=','cancel')]"/>
                <filter name="customer" string="Customer" domain="[('partner_id.customer_rank','&gt;', 0)]"/>
                <filter name="partner" string="Partner" domain="[('partner_id.supplier_rank','&gt;', 0)]"/>
                <separator/>
                <field name="partner_id" operator="child_of"/>
                <field name="account_id"/>
                <field name="name"/>
                <field name="payment_date"/>
                <field name='reference'/>
                <field name='agent'/>
                <field name='bank_id'/>
                <field name='parent_id'/>
                <field name='tax_id'/>
                <field name="account_payment_id"/>
                <group>
                    <filter name="group_by_parent_id" string="Parent" context="{'group_by':'parent_id'}"/>
                    <filter name="group_by_partner_id" string="Partner" context="{'group_by':'partner_id'}"/>
                    <filter name="group_by_account_id" string="Account" context="{'group_by':'account_id'}"/>
                    <filter name="status" string="Status" context="{'group_by':'state'}"/>
                    <separator/>
                    <filter string="Payment Date" name="invoicedate" context="{'group_by':'payment_date'}"/>
                    <filter string="Due Date" name="duedate" context="{'group_by':'due_date'}"/>
                    <separator/>
                    <filter string="Journal" name="journal_id" context="{'group_by':'journal_id'}"/>
                    <filter string="Bank" name="bank_id" context="{'group_by':'bank_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- PDC Actions -->
    <record id="sh_pdc_wizard_action" model="ir.actions.act_window">
        <field name="name">PDC Payment</field>
        <field name="res_model">pdc.wizard</field>
        <field name="view_id" ref="sh_pdc_payment_form_view"/>
        <field name="target">new</field>
    </record>

    <record id="sh_pdc_payment_menu_action" model="ir.actions.act_window">
        <field name="name">PDC Cheque Payment</field>
        <field name="res_model">pdc.wizard</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="sh_pdc.view_sh_pdc_filter"/>
        <field name="domain">[('pdc_group','=',True)]</field>
        <field
                name="view_ids"
                eval="[(5, 0, 0),
                   (0, 0, {'view_mode': 'list', 'view_id': ref('sh_pdc_tree_form')}),
                   (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pdc_payment_form_view')}),
                  ]"
        />
        <field name="context">{'default_pdc_group': True}</field>
    </record>

    <record id="sh_pdc_payment_menu_transactions_action" model="ir.actions.act_window">
        <field name="name">PDC Cheque Payment</field>
        <field name="res_model">pdc.wizard</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="sh_pdc.view_sh_pdc_filter"/>
        <field name="domain">[('pdc_group','=',False)]</field>
        <field
                name="view_ids"
                eval="[(5, 0, 0),
                   (0, 0, {'view_mode': 'list', 'view_id': ref('sh_pdc_tree_form')}),
                   (0, 0, {'view_mode': 'form', 'view_id': ref('sh_pdc_payment_form_view')}),
                  ]"
        />
    </record>

    <!-- PDC Menu -->
    <menuitem id="menu_pdc_payment" name="PDC payment" groups="account.group_account_invoice"
              parent="accountant.menu_accounting" sequence="25"/>
    <menuitem id="menu_pdc_groups" name="PDC Groups" groups="account.group_account_invoice"
              parent="sh_pdc.menu_pdc_payment" sequence="10" action="sh_pdc_payment_menu_action"/>
    <menuitem id="menu_pdc_transaction" name="PDC Transactions" groups="account.group_account_invoice"
              parent="sh_pdc.menu_pdc_payment" sequence="20" action="sh_pdc_payment_menu_transactions_action"/>

    <!-- account.move (Journal Entry) -->
    <record id="sh_pdc_action_move_journal_line" model="ir.actions.act_window">
        <field name="name">Journal Entries</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="view_id" ref="account.view_move_tree"/>
        <field name="search_view_id" ref="account.view_account_move_filter"/>
        <field name="context">{'default_type': 'entry','view_no_maturity': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a journal entry
            </p>
            <p>
                A journal entry consists of several journal items, each of which is either a debit or a credit
                transaction.
            </p>
        </field>
    </record>

</odoo>
